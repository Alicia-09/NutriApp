{% extends 'base.html' %}

{% block pagina %}
Recetas
{% endblock %}

{% block titulo %}
Recetas
{% endblock %}

{% block menu %}
    <div class="seccion-clara">
        <div class="container">

        <div class="row mb-4">
            <div class="col-12">
                <div class="seccion-clara titulo-naranja p-4 rounded">
                    <h1 class="display-6"><i class="fas fa-search me-2"></i>Buscar Recetas</h1>
                    <p class="lead mb-0">Encuentra recetas deliciosas y saludables</p>
                </div>
            </div>
        </div>


        <div class="row mb-4">
            <div class="col-12">
                <div class="card card-custom">
                    <div class="card-body">

                        <form method="GET" action="/buscar_recetas">
                            <div class="row g-3 align-items-end">

                                <div class="col-md-6">
                                    <label for="query" class="form-label text-success">¿Que quieres cocinar?</label>
                                    <input type="text" class="form-control" id="query" name="query" 
                                           placeholder="Ej: pollo, ensalada, etc..." value="{{ query if query }}">
                                </div>
                                <div class="col-md-3">
                                    <label for="diet" class="form-label text-success">Tipo de dieta</label>
                                    <select class="form-select" id="diet" name="diet">
                                        <option value="">Todas</option>
                                        <option value="vegetarian">Vegetariana</option>
                                        <option value="vegan">Vegana</option>
                                        <option value="glutenfree">Sin gluten</option>
                                        <option value="ketogenic">Keto</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <button type="submit" class="btn boton-naranja w-100">
                                        <i class="fas fa-search me-1"></i> Buscar
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card card-custom">
                    <div class="card-body p-0">

                        <div class="table-responsive">
                            <table class="table table-hover table-striped mb-4">
                                <thead class="table-success">
                                    <tr>
                                        <th scope="col" class="text-center text-success">Imagen</th>
                                        <th scope="col" class="text-success">Receta</th>
                                        <th scope="col" class="text-center text-success">Tiempo</th>
                                        <th scope="col" class="text-center text-success">Porciones</th>
                                        <th scope="col" class="text-center text-success">Calorías</th>
                                        <th scope="col" class="text-center text-success">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for receta in recetas %}
                                    <tr>
                                        <td class="text-center">
                                            {% if receta.image %}
                                            <img src="{{ receta.image }}"
                                                alt="{{ receta.title }}" 
                                                class="receta-img">
                                            {% else %}
                                            <div class="receta-placeholder">
                                                <i class="fas fa-utensils text-white"></i>
                                            </div>
                                            {% endif %}
                                        </td>                                        
                                            <h6 class="mb-1 titulo-naranja">{{ receta.title }}</h6>
                                            <p class="text-muted small mb-0">
                                                {% if receta.summary %}
                                                    {{ receta.summary|striptags|truncate(100) }}
                                                {% endif %}
                                            </p>
                                            <div class="mt-1">
                                                {% if receta.vegetarian %}
                                                <span class="badge bg-success">Vegetariana</span>
                                                {% endif %}
                                                {% if receta.vegan %}
                                                <span class="badge bg-success">Vegana</span>
                                                {% endif %}
                                                {% if receta.glutenFree %}
                                                <span class="badge bg-info">Sin gluten</span>
                                                {% endif %}
                                                {% if receta.dairyFree %}
                                                <span class="badge bg-warning">Sin lácteos</span>
                                                {% endif %}
                                            </div>
                                        </td>
                                        <td class="text-center">
                                            {% if receta.readyInMinutes %}
                                            <div class="d-flex flex-column align-items-center">
                                                <i class="fas fa-clock titulo-verde mb-1"></i>
                                                <span class="fw-bold">{{ receta.readyInMinutes }} min</span>
                                            </div>
                                            {% else %}
                                            <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td class="text-center">
                                            {% if receta.servings %}
                                            <div class="d-flex flex-column align-items-center">
                                                <i class="fas fa-users titulo-naranja mb-1"></i>
                                                <span class="fw-bold">{{ receta.servings }}</span>
                                            </div>
                                            {% else %}
                                            <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td class="text-center">
                                            {% if receta.nutrition and receta.nutrition.nutrients %}
                                                {% for nutrient in receta.nutrition.nutrients %}
                                                    {% if nutrient.name == 'Calories' %}
                                                    <div class="d-flex flex-column align-items-center">
                                                        <i class="fas fa-fire text-danger mb-1"></i>
                                                        <span class="fw-bold">{{ nutrient.amount|int }} kcal</span>
                                                    </div>
                                                    {% endif %}
                                                {% endfor %}
                                            {% else %}
                                            <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td class="text-center">
                                            <div class="btn-group" role="group">
                                                <a href="/receta/{{ receta.id }}" class="btn btn-sm boton-naranja">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                {% if session.loggeado %}
                                                <button type="button" class="btn btn-sm btn-outline-success">
                                                    <i class="fas fa-heart"></i>
                                                </button>
                                                {% endif %}
                                            </div>
                                        </td>
                                    </tr>
                                    {% else %}
                                    <tr>
                                        <td colspan="6" class="text-center py-4">
                                            <div class="text-muted">
                                                <i class="fas fa-search fa-2x mb-3"></i>
                                                <h5 class="titulo-naranja">No se encontraron recetas</h5>
                                                <p>Intenta con otros términos de búsqueda</p>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}